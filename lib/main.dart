import 'package:flutter/material.dart';
import 'package:flutter/foundation.dart'; // 2025/12/21 - ì›¹ í”Œë«í¼ ì²´í¬ìš© - ì‘ì„±ì: ì§„ì›
import 'package:provider/provider.dart';
import 'package:intl/date_symbol_data_local.dart';
import 'package:tkbank/providers/auth_provider.dart';
import 'package:tkbank/providers/register_provider.dart';
import 'package:tkbank/providers/seed_event_provider.dart';
import 'package:tkbank/services/FcmService.dart';
import 'package:tkbank/services/seed_event_service.dart';
import 'package:tkbank/screens/splash_screen.dart';
import 'navigator_key.dart';
import 'package:tkbank/screens/product/join/join_step4_screen.dart';
import 'package:tkbank/screens/product/join/join_step3_screen.dart';
import 'package:tkbank/screens/product/join/join_step2_screen.dart';
import 'package:tkbank/models/product_join_request.dart';
import 'package:tkbank/theme/app_colors.dart'; // 25.12.30 ì²œìˆ˜ë¹ˆ

Future<void> main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await initializeDateFormatting('ko_KR', null);

  // 2025/12/21 - ì›¹ì—ì„œëŠ” Firebase ì´ˆê¸°í™” ê±´ë„ˆë›°ê¸° - ì‘ì„±ì: ì§„ì›
  if (!kIsWeb) {
    await FcmService.init();
  }

  runApp(
    MultiProvider(
      providers: [
        ChangeNotifierProvider(create: (_) => AuthProvider()),
        ChangeNotifierProvider(create: (_) => RegisterProvider()),
        // 2025/12/23 -  ê¸ˆì—´ë§¤ ì´ë²¤íŠ¸ Provider ì¶”ê°€ - ì‘ì„±ì: ì˜¤ì„œì •
        ChangeNotifierProvider(create: (_) => SeedEventProvider(SeedEventService()),),

      ],
      child: const MyApp(),
    ),
  );
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  static const String baseUrl = 'http://10.0.2.2:8080/busanbank/api';

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'TK ë”¸ê¹ì€í–‰',
      debugShowCheckedModeBanner: false,
      theme: ThemeData(
        useMaterial3: true,
        colorSchemeSeed: AppColors.white, // [25.12.29] ì „ì²´ ë°°ê²½ ì—°ë³´ë¼ìƒ‰ ì œê±° - ìˆ˜ë¹ˆ

        // ğŸ‘‡ ì „ì²´ ì•±ì— í°íŠ¸ ì ìš©!
        fontFamily: 'Pretendard',
      ),
      navigatorKey: navigatorKey, // í‘¸ì‹œ ì•Œë¦¼ í˜ì´ì§€ ì´ë™ì„ ìœ„í•œ í‚¤ ì„¤ì • - ì‘ì„±ì: ìœ¤ì¢…ì¸
      onGenerateRoute: (settings) {
        if (settings.name == '/product/join/step2') {
          final request = settings.arguments as ProductJoinRequest;
          return MaterialPageRoute(
            builder: (context) => JoinStep2Screen(
              baseUrl: baseUrl,
              request: request,
            ),
          );
        }

        if (settings.name == '/product/join/step3') {
          final request = settings.arguments as ProductJoinRequest;
          return MaterialPageRoute(
            builder: (context) => JoinStep3Screen(request: request),
          );
        }

        if (settings.name == '/product/join/step4') {
          final request = settings.arguments as ProductJoinRequest;
          return MaterialPageRoute(
            builder: (context) => JoinStep4Screen(
              baseUrl: baseUrl,
              request: request,
            ),
          );
        }

        return null;
      },
      home: const SplashScreen(),
    );
  }
}